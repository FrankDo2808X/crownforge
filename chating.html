<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CrownForge | Forge-Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root {
  --accent: #00f2ff;
  --accent2: #7000ff;
  --bg-dark: #05080a;
  --glass: rgba(255, 255, 255, 0.05);
  --glass-border: rgba(255, 255, 255, 0.1);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background-color: var(--bg-dark);
  background-image: 
    radial-gradient(circle at 0% 0%, rgba(112, 0, 255, 0.15) 0%, transparent 40%),
    radial-gradient(circle at 100% 100%, rgba(0, 242, 255, 0.15) 0%, transparent 40%);
  font-family: 'Plus Jakarta Sans', sans-serif;
  color: #fff;
  overflow: hidden;
}

/* --- HEADER --- */
header {
  padding: 1.2rem;
  text-align: center;
  background: rgba(255, 255, 255, 0.02);
  backdrop-filter: blur(15px);
  border-bottom: 1px solid var(--glass-border);
  font-weight: 800;
  font-size: 1.2rem;
  letter-spacing: 1px;
  color: var(--accent);
  text-transform: uppercase;
  text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
}

/* --- TYPING STATUS --- */
#typingStatus {
  text-align: center;
  font-size: 0.75rem;
  padding: 8px;
  color: var(--accent2);
  font-style: italic;
  font-weight: 600;
  height: 30px;
}

/* --- CHAT AREA --- */
#chatBox {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
  scrollbar-width: thin;
  scrollbar-color: var(--accent2) transparent;
}

#chatBox::-webkit-scrollbar { width: 5px; }
#chatBox::-webkit-scrollbar-thumb { background: var(--accent2); border-radius: 10px; }

/* --- MESSAGE BUBBLES --- */
.msg {
  max-width: 75%;
  padding: 12px 16px;
  border-radius: 18px 18px 18px 4px;
  background: var(--glass);
  border: 1px solid var(--glass-border);
  backdrop-filter: blur(5px);
  position: relative;
  animation: messageIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
}

@keyframes messageIn {
  from { opacity: 0; transform: translateY(20px) scale(0.9); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.msg.own {
  align-self: flex-end;
  border-radius: 18px 18px 4px 18px;
  background: linear-gradient(135deg, var(--accent2), #4e00b3);
  border: none;
  box-shadow: 0 10px 20px rgba(112, 0, 255, 0.2);
}

.user {
  font-size: 0.7rem;
  text-transform: uppercase;
  font-weight: 800;
  margin-bottom: 4px;
  color: var(--accent);
}

.own .user { color: #fff; opacity: 0.8; }

.text {
  font-size: 0.95rem;
  line-height: 1.5;
  word-wrap: break-word;
}

/* --- INPUT AREA --- */
#inputArea {
  padding: 20px;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(20px);
  display: flex;
  gap: 12px;
  align-items: flex-end;
  border-top: 1px solid var(--glass-border);
}

#msgInput {
  flex: 1;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--glass-border);
  border-radius: 15px;
  padding: 12px 18px;
  color: white;
  font-family: inherit;
  font-size: 0.95rem;
  outline: none;
  resize: none;
  max-height: 150px;
  transition: 0.3s;
}

#msgInput:focus {
  border-color: var(--accent);
  background: rgba(255, 255, 255, 0.08);
  box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
}

#sendBtn {
  background: linear-gradient(135deg, var(--accent), #00a2ff);
  color: #000;
  border: none;
  width: 50px;
  height: 50px;
  border-radius: 15px;
  font-weight: 800;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.3s;
  flex-shrink: 0;
}

#sendBtn:hover {
  transform: scale(1.05) rotate(5deg);
  box-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
}

/* Icon for Send (using text if no SVG) */
#sendBtn::after {
  content: '➤';
  font-size: 1.2rem;
}

@media(max-width: 600px) {
  .msg { max-width: 85%; }
  #inputArea { padding: 15px; }
}
</style>
</head>

<body>

<header>Forge Global Chat</header>
<div id="typingStatus"></div>

<div id="chatBox">
  </div>

<div id="inputArea">
  <textarea id="msgInput" placeholder="Write something..." rows="1"></textarea>
  <button id="sendBtn" title="Send Message"></button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyDNy1J7zVJMLGLsyUxRT1EIaIBruI_p2G8",
  authDomain: "crownforgestudio-2581a.firebaseapp.com",
  projectId: "crownforgestudio-2581a"
});

const db = firebase.firestore();
let username = localStorage.getItem("username") || prompt("Enter your Cyber-Name") || "RogueUser";
localStorage.setItem("username", username);

const chatRef = db.collection("globalChat");
const typingRef = db.collection("typing");
const chatBox = document.getElementById("chatBox");
const input = document.getElementById("msgInput");
const typingStatus = document.getElementById("typingStatus");

/* AUTO-RESIZE TEXTAREA */
input.addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = (this.scrollHeight) + 'px';
});

/* SEND LOGIC */
function send() {
  const text = input.value.trim();
  if(!text) return;
  
  chatRef.add({
    user: username,
    text: text,
    time: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  input.value = "";
  input.style.height = 'auto';
  typingRef.doc(username).delete();
}

document.getElementById("sendBtn").onclick = send;
input.addEventListener("keydown", e => {
  if(e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});

/* SYNC MESSAGES */
chatRef.orderBy("time").limitToLast(50).onSnapshot(snap => {
  chatBox.innerHTML = "";
  snap.forEach(doc => {
    const d = doc.data();
    const div = document.createElement("div");
    div.className = `msg ${d.user === username ? 'own' : ''}`;
    div.innerHTML = `
      <div class="user">${d.user}</div>
      <div class="text">${d.text}</div>
    `;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
});

/* TYPING INDICATOR */
let typingTimer;
input.addEventListener("input", () => {
  typingRef.doc(username).set({ typing: true });
  clearTimeout(typingTimer);
  typingTimer = setTimeout(() => typingRef.doc(username).delete(), 2000);
});

typingRef.onSnapshot(snap => {
  const users = [];
  snap.forEach(d => { if(d.id !== username) users.push(d.id); });
  typingStatus.textContent = users.length ? `• ${users.join(", ")} typing...` : "";
});
</script>

</body>
</html>
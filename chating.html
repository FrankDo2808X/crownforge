<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CrownForge Global Chat</title>

<style>
:root {
  --accent:#00c8ff;
  --accent2:#00ffd9;
  --bg:#0b0f1a;
  --glass:rgba(255,255,255,0.08);
  --text:#fff;
}

*{box-sizing:border-box}

body{
  margin:0;
  height:100vh;
  display:flex;
  flex-direction:column;
  background:radial-gradient(circle at top,#1a1a2e,#000);
  font-family:Poppins,sans-serif;
  color:var(--text);
}

/* HEADER */
header{
  padding:14px;
  text-align:center;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  font-weight:600;
}

/* TYPING */
#typingStatus{
  text-align:center;
  font-size:0.85em;
  padding:4px;
  color:#00ffd9;
  min-height:18px;
}

/* CHAT */
#chatBox{
  flex:1;
  overflow-y:auto;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* MESSAGE */
.msg{
  max-width:85%;
  background:var(--glass);
  padding:10px 14px;
  border-radius:14px;
  animation:fade .2s;
}

.msg.own{
  align-self:flex-end;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}

.user{
  font-size:.75em;
  opacity:.85;
  font-weight:600;
}

.text{
  margin-top:4px;
  font-size:.95em;
  line-height:1.4;
  word-wrap:break-word;
}

/* INPUT */
#inputArea{
  display:flex;
  gap:8px;
  padding:10px;
  background:rgba(0,0,0,.6);
}

#msgInput{
  flex:1;
  resize:vertical;
  min-height:42px;
  max-height:120px;
  border-radius:10px;
  border:none;
  padding:10px;
  font-size:1em;
  background:rgba(255,255,255,.1);
  color:white;
  outline:none;
}

#sendBtn{
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  font-weight:600;
  cursor:pointer;
}

/* RESPONSIVE */
@media(max-width:600px){
  .msg{max-width:95%}
  #sendBtn{padding:10px}
}

@keyframes fade{
  from{opacity:0;transform:translateY(8px)}
  to{opacity:1}
}
</style>
</head>

<body>

<header>CrownForge Global Chat</header>
<div id="typingStatus"></div>
<div id="chatBox"></div>

<div id="inputArea">
  <textarea id="msgInput" placeholder="Type message..."></textarea>
  <button id="sendBtn">Send</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyDNy1J7zVJMLGLsyUxRT1EIaIBruI_p2G8",
  authDomain: "crownforgestudio-2581a.firebaseapp.com",
  projectId: "crownforgestudio-2581a"
});

const db = firebase.firestore();

/* USERNAME */
let username = localStorage.getItem("username");
if(!username){
  username = prompt("Enter username");
  localStorage.setItem("username",username);
}

/* REFS */
const chatRef = db.collection("globalChat");
const typingRef = db.collection("typing");
const chatBox = document.getElementById("chatBox");
const input = document.getElementById("msgInput");
const typingStatus = document.getElementById("typingStatus");

/* SEND MESSAGE */
document.getElementById("sendBtn").onclick = send;
input.addEventListener("keydown",e=>{ if(e.key==="Enter"&&!e.shiftKey){ e.preventDefault(); send(); }});

function send(){
  const text=input.value.trim();
  if(!text)return;
  chatRef.add({
    user:username,
    text,
    time:firebase.firestore.FieldValue.serverTimestamp()
  });
  input.value="";
  typingRef.doc(username).delete();
}

/* REALTIME CHAT */
chatRef.orderBy("time").onSnapshot(snap=>{
  chatBox.innerHTML="";
  snap.forEach(doc=>{
    const d=doc.data();
    const div=document.createElement("div");
    div.className="msg "+(d.user===username?"own":"");
    div.innerHTML=`<div class="user">${d.user}</div><div class="text">${d.text}</div>`;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
});

/* ðŸ”´ TYPING INDICATOR */
let typingTimer;
input.addEventListener("input",()=>{
  typingRef.doc(username).set({typing:true});
  clearTimeout(typingTimer);
  typingTimer=setTimeout(()=>typingRef.doc(username).delete(),1200);
});

typingRef.onSnapshot(snap=>{
  const users=[];
  snap.forEach(d=>{ if(d.id!==username) users.push(d.id); });
  typingStatus.textContent=users.length?`${users.join(", ")} typing...`:"";
});
</script>

</body>
</html>

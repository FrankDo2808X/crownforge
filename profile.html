<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CrownForge â€” Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#050505,#111122,#000000);
  color:#fff;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}
.bg{
  position:fixed;inset:0;
  background:
    radial-gradient(circle at 20% 20%,#ff00c855,transparent 60%),
    radial-gradient(circle at 80% 80%,#00ffff55,transparent 60%);
  filter:blur(100px);
  animation:pulse 10s ease-in-out infinite alternate;
  z-index:0;
}
@keyframes pulse{
  0%{opacity:.6;transform:scale(1);}
  100%{opacity:1;transform:scale(1.2);}
}
.card{
  position:relative;
  z-index:2;
  backdrop-filter:blur(25px);
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:20px;
  padding:40px 30px;
  width:90%;
  max-width:420px;
  box-shadow:0 0 40px rgba(255,0,255,0.3),inset 0 0 30px rgba(255,255,255,0.05);
  text-align:center;
  transition:.4s;
}
.card:hover{box-shadow:0 0 60px rgba(0,255,255,0.4);}
h2{
  font-size:22px;
  background:linear-gradient(90deg,#ff00ff,#00ffff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:10px;
}
.profile-pic{
  width:110px;height:110px;
  border-radius:50%;
  border:3px solid #00ffff;
  object-fit:cover;
  box-shadow:0 0 20px #00ffff88;
  margin-bottom:15px;
  cursor:pointer;
  transition:.3s;
}
.profile-pic:hover{transform:scale(1.05);}
input[type="file"]{display:none;}
p{margin:6px 0;}
.uid-box{
  background:rgba(255,255,255,0.08);
  font-size:13px;
  padding:8px;
  border-radius:10px;
  color:#ccc;
  margin-bottom:10px;
  word-break:break-all;
}
label{
  display:block;
  text-align:left;
  margin-top:10px;
  font-size:14px;
  color:#ccc;
}
input,textarea{
  width:100%;
  margin-top:5px;
  padding:10px;
  border:none;
  border-radius:10px;
  background:rgba(255,255,255,0.12);
  color:#fff;
  font-size:15px;
  outline:none;
  transition:.2s;
}
input:focus,textarea:focus{box-shadow:0 0 10px #00ffff;}
textarea{resize:none;height:70px;}
button{
  background:linear-gradient(45deg,#00ffff,#ff00ff);
  border:none;
  color:#000;
  padding:12px 30px;
  border-radius:12px;
  font-weight:600;
  margin-top:20px;
  cursor:pointer;
  transition:.3s;
}
button:hover{
  transform:scale(1.05);
  box-shadow:0 0 20px #00ffff;
}
.logout-btn{
  background:linear-gradient(45deg,#ff0033,#ff6600);
  color:#fff;
  margin-top:10px;
}
.save-msg{
  opacity:0;
  margin-top:8px;
  font-size:14px;
  color:#00fff7;
  transition:opacity .4s ease;
}
.save-msg.show{opacity:1;}
.footer{
  position:absolute;
  bottom:10px;
  width:100%;
  text-align:center;
  font-size:12px;
  color:#888;
}
</style>
</head>

<body>
<div class="bg"></div>
<div class="card">
  <img id="profilePic" class="profile-pic" src="https://i.imgur.com/5QH1XGQ.png" alt="Profile Picture">
  <input type="file" id="fileInput" accept="image/*">

  <h2>ðŸ‘¤ Your Profile</h2>
  <p><strong>Email:</strong> <span id="userEmail">Loading...</span></p>
  <p><strong>UID:</strong></p>
  <div class="uid-box" id="userUID">Loading...</div>

  <label>Display Name</label>
  <input type="text" id="displayName" placeholder="Enter your name">

  <label>Bio</label>
  <textarea id="userBio" placeholder="Write something cool..."></textarea>

  <button id="saveChanges">ðŸ’¾ Save Changes</button>
  <p class="save-msg" id="saveMsg">Saved successfully âœ…</p>

  <button class="logout-btn" id="logoutBtn">ðŸšª Logout</button>
</div>

<div class="footer">CrownForge Studio Â© 2025</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

// CrownForge Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyDNy1J7zVJMLGLsyUxRT1EIaIBruI_p2G8",
  authDomain: "crownforgestudio-2581a.firebaseapp.com",
  projectId: "crownforgestudio-2581a",
  storageBucket: "crownforgestudio-2581a.appspot.com",
  messagingSenderId: "223324386293",
  appId: "1:223324386293:web:9d7919c6b2e93781b026bc",
  measurementId: "G-FC52FSYPGV"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const emailEl = document.getElementById("userEmail");
const uidEl = document.getElementById("userUID");
const nameEl = document.getElementById("displayName");
const bioEl = document.getElementById("userBio");
const saveMsg = document.getElementById("saveMsg");
const picEl = document.getElementById("profilePic");
const fileInput = document.getElementById("fileInput");

// Load user data
onAuthStateChanged(auth, async (user) => {
  if (!user) return (window.location.href = "index.html");
  emailEl.textContent = user.email;
  uidEl.textContent = user.uid;
  nameEl.value = user.displayName || "";

  // Load Firestore bio + photo
  const userRef = doc(db, "users", user.uid);
  const snap = await getDoc(userRef);
  if (snap.exists()) {
    const data = snap.data();
    bioEl.value = data.bio || "";
    if (data.photoURL) picEl.src = data.photoURL;
  } else {
    await setDoc(userRef, {});
  }

  // If Firebase user has photoURL but not in Firestore
  if (user.photoURL && !snap.data()?.photoURL) {
    picEl.src = user.photoURL;
  }
});

// Save name and bio
document.getElementById("saveChanges").addEventListener("click", async () => {
  const user = auth.currentUser;
  if (!user) return;
  try {
    await updateProfile(user, { displayName: nameEl.value });
    await setDoc(doc(db, "users", user.uid), {
      bio: bioEl.value,
      photoURL: user.photoURL || null
    }, { merge: true });
    saveMsg.textContent = "Changes saved âœ…";
    saveMsg.classList.add("show");
    setTimeout(() => saveMsg.classList.remove("show"), 2000);
  } catch (err) {
    alert("Error: " + err.message);
  }
});

// Upload profile picture
picEl.addEventListener("click", ()=> fileInput.click());
fileInput.addEventListener("change", async (e) => {
  const file = e.target.files[0];
  const user = auth.currentUser;
  if (!file || !user) return;
  try {
    const imgRef = ref(storage, `profilePics/${user.uid}.jpg`);
    await uploadBytes(imgRef, file);
    const url = await getDownloadURL(imgRef);
    await updateProfile(user, { photoURL: url });
    await setDoc(doc(db, "users", user.uid), { photoURL: url }, { merge: true });
    picEl.src = url;
    saveMsg.textContent = "Profile picture updated âœ…";
    saveMsg.classList.add("show");
    setTimeout(() => saveMsg.classList.remove("show"), 2000);
  } catch (err) {
    alert("Error uploading image: " + err.message);
  }
});

// Logout
document.getElementById("logoutBtn").addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "index.html";
});
</script>
</body>
</html>

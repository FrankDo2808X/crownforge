<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CrownForge - Login / Signup</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{
margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
background:radial-gradient(circle at 25% 25%,#ff8800,transparent 40%),
radial-gradient(circle at 75% 75%,#00d5ff,transparent 40%),#060606;
overflow:hidden;
}
.bg-glow{
position:fixed;inset:0;
background:radial-gradient(circle at 30% 30%,#ff007f66,transparent 60%),
radial-gradient(circle at 70% 70%,#00ffff55,transparent 60%);
filter:blur(100px);animation:pulse 8s infinite alternate;z-index:0;
}
@keyframes pulse{0%{opacity:.5}100%{opacity:1;transform:scale(1.2)}}
.particle{position:absolute;border-radius:50%;opacity:.6;filter:blur(5px);animation:floaty 10s infinite}
@keyframes floaty{0%{transform:translate(0)}50%{transform:translate(-40px,30px)}100%{transform:translate(0)}}
.auth-card{
position:relative;width:360px;padding:40px 30px;border-radius:20px;
backdrop-filter:blur(25px);background:rgba(255,255,255,.05);
box-shadow:0 0 50px rgba(255,0,128,.4);color:#fff;text-align:center;z-index:2;
}
.auth-card h2{
background:linear-gradient(90deg,#ff7b00,#ff00c8);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
input{
width:100%;padding:12px;margin:8px 0;border:none;border-radius:10px;
background:rgba(255,255,255,.1);color:#fff;
}
button{
width:100%;padding:12px;margin-top:15px;border:none;border-radius:10px;
background:linear-gradient(90deg,#ff7b00,#ff00c8);cursor:pointer;
}
.google-btn{display:flex;justify-content:center;gap:10px;background:#fff;color:#000}
.google-btn img{width:20px}
.switch-link{color:#ff7b00;cursor:pointer;font-size:13px;text-decoration:underline}
.form{display:none}
.form.active{display:block}
.loader{
width:30px;height:30px;border:4px solid transparent;border-top:4px solid red;
border-radius:50%;animation:spin 1s linear infinite;display:none;margin:auto;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="bg-glow"></div>

<script>
for(let i=0;i<20;i++){
const d=document.createElement("div");
d.className="particle";
d.style.width=d.style.height=Math.random()*6+3+"px";
d.style.background=["#ff00c8","#ff7b00","#00ffff"][Math.floor(Math.random()*3)];
d.style.top=Math.random()*100+"%";
d.style.left=Math.random()*100+"%";
document.body.appendChild(d);
}
</script>

<div class="auth-card">
<div id="loginForm" class="form active">
<h2>Welcome to CrownForge</h2>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Password">
<button id="loginBtn">Login</button>
<button id="googleLogin" class="google-btn">
<img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg">Google
</button>
<p class="switch-link" onclick="switchForm('signup')">Create Account</p>
</div>

<div id="signupForm" class="form">
<h2>Create Account</h2>
<input id="signupEmail" placeholder="Email">
<input id="signupPass" type="password" placeholder="Password">
<input id="signupConfirm" type="password" placeholder="Confirm Password">
<button id="signupBtn">Signup</button>
<button id="googleSignup" class="google-btn">
<img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg">Google
</button>
<p class="switch-link" onclick="switchForm('login')">Already have account?</p>
</div>

<div id="loader" class="loader"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
signInWithPopup, GoogleAuthProvider, setPersistence,
browserLocalPersistence, onAuthStateChanged, signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
getFirestore, doc, setDoc, getDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { firebaseConfig } from "./firebase-config.js";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();
const loader = document.getElementById("loader");

// ðŸ” 1 MONTH SESSION
const ONE_MONTH = 30 * 24 * 60 * 60 * 1000;

function showLoader(s){loader.style.display=s?"block":"none"}
window.switchForm=f=>{
document.querySelectorAll(".form").forEach(x=>x.classList.remove("active"));
document.getElementById(f+"Form").classList.add("active");
};

async function ensureUser(user){
const ref=doc(db,"users",user.uid);
if(!(await getDoc(ref)).exists()){
await setDoc(ref,{
uid:user.uid,
email:user.email,
createdAt:serverTimestamp()
});
}
}

// LOGIN
loginBtn.onclick=async()=>{
showLoader(true);
await setPersistence(auth,browserLocalPersistence);
const c=await signInWithEmailAndPassword(auth,loginEmail.value,loginPass.value);
localStorage.setItem("cf_login_time",Date.now());
await ensureUser(c.user);
location.href="Crownforgepage.html";
};

// SIGNUP
signupBtn.onclick=async()=>{
if(signupPass.value!==signupConfirm.value)return alert("Passwords not match");
showLoader(true);
const c=await createUserWithEmailAndPassword(auth,signupEmail.value,signupPass.value);
localStorage.setItem("cf_login_time",Date.now());
await ensureUser(c.user);
location.href="Crownforgepage.html";
};

// GOOGLE
[googleLogin,googleSignup].forEach(b=>{
b.onclick=async()=>{
showLoader(true);
await setPersistence(auth,browserLocalPersistence);
const r=await signInWithPopup(auth,provider);
localStorage.setItem("cf_login_time",Date.now());
await ensureUser(r.user);
location.href="Crownforgepage.html";
};
});

// ðŸ” AUTO CHECK SESSION
onAuthStateChanged(auth,async(user)=>{
if(user){
const t=localStorage.getItem("cf_login_time");
if(!t || Date.now()-t>ONE_MONTH){
await signOut(auth);
localStorage.removeItem("cf_login_time");
}else{
await ensureUser(user);
location.href="Crownforgepage.html";
}
}
});
</script>
</body>
</html>
